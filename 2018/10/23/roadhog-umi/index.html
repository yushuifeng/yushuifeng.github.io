
<!DOCTYPE html>
<html lang="" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SF.Y</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="记脚手架升级现有脚手架使用半年有余了，各依赖一直没有升级。前几天开发过程中出现了开发环境使用了最新版 API 而测试环境上不支持而引发报错的问题。
对依赖进行升级的过程中关注到了基础脚手架的版本,"> 
    <meta name="author" content="SF.Y"> 
    <link rel="alternative" href="atom.xml" title="SF.Y" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.ico"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
</head>

<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">roadhog -> umi</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">roadhog -> umi</h1>
        <div class="stuff">
            <span>十月 23, 2018</span>
            

        </div>
        <div class="content markdown">
            <h1 id="记脚手架升级"><a href="#记脚手架升级" class="headerlink" title="记脚手架升级"></a>记脚手架升级</h1><p>现有脚手架使用半年有余了，各依赖一直没有升级。前几天开发过程中出现了开发环境使用了最新版 API 而测试环境上不支持而引发报错的问题。</p>
<p>对依赖进行升级的过程中关注到了基础脚手架的版本，对其了解后进而进行了整体的升级：从 ant-design-pro v1.0 -&gt; v2.1</p>
<p>借鉴上次的经验，直接去 <img src="https://gw.alipayobjects.com/zos/rmsportal/KDpgvguMpGfqaHPjicRK.svg" width="10"><a href="https://pro.ant.design/docs/upgrade-v2-cn" target="_blank" rel="noopener">ant-design-pro</a> 官网，文档中有升级到2.0版本的详细步骤。本质上要的就是脚手架的变化，roadhog -&gt; umi！</p>
<p>没有什么特殊的问题，按照步骤操作就可以。<br>摘抄一下官网的条目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- 把 package.json roadhog 的依赖修改为 umi。</span><br><span class="line">- 拷贝 .webpackrc.js 中的配置到 config/config.js 中。</span><br><span class="line">- 修改 src/routes 目录名称为 pages，pages 是 umi 约定的目录。</span><br><span class="line">- 删除 src/models/index.js，在 umi 中 models 文件夹中的 dva model 会被自动挂载。</span><br><span class="line">- 重命名 index.ejs 为 pages/document.ejs，它是 umi 约定的文件。</span><br><span class="line">- 修改 index.less 为 global.less 和修改 index.js 为 global.js，他们也是 umi 约定的文件。</span><br><span class="line">- 在 config/config.js 中添加路由配置 routes。</span><br><span class="line">- 修改 src/layouts/BasicLayout.js 中的组件嵌套语法。</span><br><span class="line">- 修改 404 页面。</span><br><span class="line">- 修改权限路由 AuthorizedRoute 的逻辑。</span><br><span class="line">- 修改 mock。</span><br><span class="line">- 在 .gitignore 中添加 umi 相关文件。</span><br><span class="line">- 通过执行 tnpm start 和 tnpm run lint 修改可能出现的问题。</span><br></pre></td></tr></table></figure></p>
<p>注意一定要先了解一下 <a href="https://umijs.org/zh/" target="_blank" rel="noopener">UmiJS</a> ！</p>
<h1 id="【附：迁移步骤细节】"><a href="#【附：迁移步骤细节】" class="headerlink" title="【附：迁移步骤细节】"></a>【附：迁移步骤细节】</h1><h3 id="修改-roadhog-依赖为-umi"><a href="#修改-roadhog-依赖为-umi" class="headerlink" title="修改 roadhog 依赖为 umi"></a>修改 roadhog 依赖为 umi</h3><p>打开项目根目录下的 <code>package.json</code>，修改依赖为 umi：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">"dependencies": &#123;</span><br><span class="line"><span class="deletion">- "dva": "^2.2.3",</span></span><br><span class="line"><span class="deletion">- "dva-loading": "^2.0.3",</span></span><br><span class="line"><span class="deletion">- "react-dom": "^16.4.1",</span></span><br><span class="line"><span class="deletion">- "react-loadable": "^5.5.0",</span></span><br><span class="line">  ...</span><br><span class="line">&#125;,</span><br><span class="line">"devDependencies": &#123;</span><br><span class="line"><span class="addition">+ "umi": "^2.0.0",</span></span><br><span class="line"><span class="addition">+ "umi-plugin-react": "^1.0.0",</span></span><br><span class="line"><span class="deletion">- "roadhog": "^2.4.2",</span></span><br><span class="line"><span class="deletion">- "roadhog-api-doc": "^1.1.2",</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 umi 中内置了 React，通过 umi-plugin-react 插件集内置了 antd 和 dva 等 React 技术栈常用的库。可以参考 <a href="https://umijs.org/plugin/umi-plugin-react.html" target="_blank" rel="noopener">umi-plugin-react 的文档</a>。</p>
<p>另外 <code>package.json</code> 中的 scripts 也要做对应的修改：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- "start": "cross-env ESLINT=none roadhog dev",</span></span><br><span class="line"><span class="deletion">- "start:no-proxy": "cross-env NO_PROXY=true ESLINT=none roadhog dev",	    </span></span><br><span class="line"><span class="deletion">- "build": "cross-env ESLINT=none roadhog build",</span></span><br><span class="line"><span class="addition">+ "start": "umi dev",</span></span><br><span class="line"><span class="addition">+ "start:no-mock": "cross-env MOCK=none umi dev",</span></span><br><span class="line"><span class="addition">+ "build": "umi build",</span></span><br></pre></td></tr></table></figure>
<p>修改完成之后记得不要忘记使用 <code>npm update</code> 将依赖更新到最新。</p>
<h3 id="添加配置文件-config-config-js"><a href="#添加配置文件-config-config-js" class="headerlink" title="添加配置文件 config/config.js"></a>添加配置文件 config/config.js</h3><p>umi 约定了 <code>.umirc.js</code> 和 <code>config/config.js</code> 为 umi 的配置文件（二选一），在 Ant Design Pro 中因为配置比较多，我们选择使用 <code>config/config.js</code>。</p>
<p>你需要在项目中创建 <code>config/config.js</code>，该配置文件需要默认导出一个对象，里面包含了 umi 的全部配置。你可以先初始化为如下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [[</span><br><span class="line">    <span class="string">'umi-plugin-react'</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      antd: <span class="literal">true</span>,</span><br><span class="line">      dva: &#123;</span><br><span class="line">        hmr: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ]]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>该配置会挂载 umi-plugin-react 插件集并打开 antd 和 dva 插件，使得你在项目中可以直接使用 antd 和 dva。</p>
<p>添加 <code>config/config.js</code> 之后你可以将你项目下的 <code>.webpackrc.js</code> 中的配置也迁移到 <code>config/config.js</code> 中。 <code>.webpackrc.js</code> 是 af-webpack 的配置文件，umi 和 roadhog 都是依赖于它，所以你可以直接迁移过来。迁移过来之后就可以删除原有的 <code>.webpackrc.js</code> 和 <code>.babelrc.js</code> 文件了。</p>
<p>不过需要注意的是 <code>.webpackrc.js</code> 中的如下配置是没有必要复制到 <code>config/config.js</code> 中的：</p>
<ul>
<li>entry: umi 会有默认的路由机制，需要删除该配置。</li>
<li>extraBabelPlugins: umi-plugin-react 中会内置对 antd 的按需编译的支持，不再需要手动配置。</li>
<li>env: env 下的 dva-hmr 插件不再需要，可以直接在 umi-plugin-react 配置中开启。</li>
<li>alias: umi 中默认会添加 <code>@/</code> 的别名到 src 目录。</li>
<li>html: umi 默认使用 <code>src/pages/document.ejs</code> 作为 html 模板。</li>
</ul>
<p>另外我们推荐将 <code>theme</code> 配置直接写到 <code>config/config.js</code> 中，然后就可以删除掉 <code>src/theme.js</code> 了。</p>
<h3 id="修改-routes-为-pages"><a href="#修改-routes-为-pages" class="headerlink" title="修改 routes 为 pages"></a>修改 routes 为 pages</h3><p>在 umi 中大量使用了约定和配置来高效的实现一些功能，其中 umi 就约定了 <code>src/pages</code> 目录为页面组件的存放目录。在 Ant Design Pro 1.0 中，我们的页面都存放在 <code>src/routes</code> 下面，所以我们只需要将 routes 重命名为 pages 即可。</p>
<h3 id="删除-models-index-js"><a href="#删除-models-index-js" class="headerlink" title="删除 models/index.js"></a>删除 models/index.js</h3><p>在 umi 中，挂载了 dva 的插件之后 models 下的文件会被默认当做 dva model 引入，所以不再需要在 <code>models/index.js</code> 中来手动挂载 model，可以直接删除该文件。</p>
<h3 id="修改-index-ejs"><a href="#修改-index-ejs" class="headerlink" title="修改 index.ejs"></a>修改 index.ejs</h3><p>移动 <code>index.ejs</code> 到 <code>pages/document.ejs</code>，它是 umi 约定的文件。参考 <a href="https://umijs.org/guide/html-template.html" target="_blank" rel="noopener">œumi HTML 模板<br>文档</a>。</p>
<h3 id="修改-index-js-和-index-less"><a href="#修改-index-js-和-index-less" class="headerlink" title="修改 index.js 和 index.less"></a>修改 index.js 和 index.less</h3><p>重命名 <code>index.js</code> 为 <code>global.js</code>，重命名 <code>index.less</code> 为 <code>global.less</code>，他们会被 umi 自动挂载。可以参考 umi 的<a href="https://umijs.org/guide/app-structure.html" target="_blank" rel="noopener">目录约定</a>。另外因为 dva 插件会自动挂载 model 并默认添加 dva-loading 插件，所以 index.js 中的 dva 相关的内容可以被移除了。只需要保留类似下面这些初始化逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./polyfill'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'moment/locale/zh-cn'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./rollbar'</span>;</span><br></pre></td></tr></table></figure>
<p>另外 <code>global.less</code> 中的 <code>:global</code> 标志也可以移除了，因为 <code>global.less</code> 中的样式默认就是全局的，这里要注意的是除了它其它都会默认使用 cssModule。</p>
<h3 id="添加路由配置"><a href="#添加路由配置" class="headerlink" title="添加路由配置"></a>添加路由配置</h3><p>这一步是最重要的，umi 内置了路由的实现，提供了约定式和配置式两种路由方式。在 Ant Design Pro 中我们使用配置式路由的方式。你需要在 <code>config/config.js</code> 中添加配置项 <code>routes</code>，在这里我们基于 <code>/dashboard</code> 页面提供了一个样例，你需要按照你的项目具体做下迁移。我们推荐添加一个 <code>config/router.config.js</code> 的文件然后在 <code>config/config.js</code> 中引入它：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/router.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    component: <span class="string">'../layouts/BasicLayout'</span>,</span><br><span class="line">    routes: [</span><br><span class="line">      <span class="comment">// dashboard</span></span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">redirect</span>: <span class="string">'/dashboard/analysis'</span> &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/dashboard'</span>,</span><br><span class="line">        name: <span class="string">'dashboard'</span>,</span><br><span class="line">        icon: <span class="string">'dashboard'</span>,</span><br><span class="line">        routes: [</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">'/dashboard/analysis'</span>, <span class="attr">name</span>: <span class="string">'analysis'</span>, <span class="attr">component</span>: <span class="string">'./Dashboard/Analysis'</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">'/dashboard/monitor'</span>, <span class="attr">name</span>: <span class="string">'monitor'</span>, <span class="attr">component</span>: <span class="string">'./Dashboard/Monitor'</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">'/dashboard/workplace'</span>, <span class="attr">name</span>: <span class="string">'workplace'</span>, <span class="attr">component</span>: <span class="string">'./Dashboard/Workplace'</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>其中 component 是一个字符串，是相对于 <code>src/pages</code> 的路径，更多的路由配置你可以参考 v2 版本的路由配置，和 umi 的文档。另外原有的 1.0 版本的路由代码 <code>src/common/router.js</code> 和 <code>src/router.js</code> 也可以删除了。</p>
<h3 id="修改布局组件"><a href="#修改布局组件" class="headerlink" title="修改布局组件"></a>修改布局组件</h3><p>因为不在使用 react-router@4 的组件式路由，所以你需要修改你的布局组件。把其中的 <code>&lt;Switch/&gt;</code> 组件部分修改为 <code>{this.props.children}</code>。</p>
<h3 id="修改-404-页面"><a href="#修改-404-页面" class="headerlink" title="修改 404 页面"></a>修改 404 页面</h3><p>在 umi 中默认使用 <code>src/pages/404.js</code> 作为 404 页面，你需要将原来的 <code>src/routes/Exception/404.js</code> 迁移过去。</p>
<h3 id="修改权限路由"><a href="#修改权限路由" class="headerlink" title="修改权限路由"></a>修改权限路由</h3><p>在 2.0 中，你可以直接使用 umi 提供的<a href="https://umijs.org/guide/router.html#%E6%9D%83%E9%99%90%E8%B7%AF%E7%94%B1" target="_blank" rel="noopener">权限路由</a>的方案。当然你也可以保留 1.0 中的方案继续使用。由于不是必要的，在本文中就不做具体说明了。</p>
<h3 id="修改-mock-数据"><a href="#修改-mock-数据" class="headerlink" title="修改 mock 数据"></a>修改 mock 数据</h3><p>在 umi 中，默认会将 <code>mock/*.js</code> 的文件作为 mock 文件。所以可以将 mock 数据的 URL 信息迁移到 mock 文件中后删除 <code>.roadhogrc.mock.js</code> 文件，但是要注意的是直接写在 <code>.roadhogrc.mock.js</code> 中的 mock 数据需要迁移出来，比如可以新建 <code>mock/common.js</code> 来迁移这部分数据。</p>
<p>更多说明可以参考 umi 的文档<a href="https://umijs.org/guide/mock-data.html" target="_blank" rel="noopener">Mock 数据</a>。</p>
<h3 id="修改-gitignore"><a href="#修改-gitignore" class="headerlink" title="修改 .gitignore"></a>修改 .gitignore</h3><p>使用 umi 后你需要将 umi 在开发和构建中的临时文件添加到 <code>.gitignore</code> 里面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.umi</span><br><span class="line">.umi-production</span><br></pre></td></tr></table></figure>
<h3 id="修改代码别名等细节"><a href="#修改代码别名等细节" class="headerlink" title="修改代码别名等细节"></a>修改代码别名等细节</h3><p>以上的操作完成之后你就可以运行 <code>npm start</code> 启动你的项目了，你会看到报错，但是不要慌，按照报错信息一步一步修改即可。你可能需要修改的内容有：</p>
<ul>
<li>修改别名 <code>components/</code> 为 <code>@/components</code>。当然你也可以直接在 <code>config/config.js</code> 保留原有的别名。</li>
<li>修改 <code>src/utils/request.js</code> 中和 dva 相关的部分。可以直接使用 <code>umi/router</code> 来做跳转。</li>
<li><code>src/utils/request.js</code> 的 <code>/exception/400</code> 可以改为 <code>/400</code>。</li>
<li>去掉 <code>BasicLayout</code> 中的 <code>const baseRedirect = this.getBaseRedirect();</code> 相关逻辑，跳转的逻辑可以通过 umi 的 routes 配置实现。</li>
<li>修改 <code>BasicLayout</code> 中的 <code>getPageTitle</code> 和 <code>getBreadcrumbNameMap</code> 的相关逻辑，参考下面的代码实现。完整代码参考 v1 升级 <a href="https://github.com/ant-design/ant-design-pro/commit/dc2118db78f9b2b7072051fea558e8d1386ce34c" target="_blank" rel="noopener">commit</a>。</li>
</ul>
<p>注：<code>memoizeOne</code> 是 <code>memoize-one</code> npm 包提供的方法，你需要先 install memoize-one。<code>deepEqual</code> 是 <code>lodash.isequal</code> 包提供的，也需要安装相关依赖。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取面包屑映射</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; menuData 菜单配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getBreadcrumbNameMap = memoizeOne(<span class="function"><span class="params">meun</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> routerMap = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> mergeMeunAndRouter = <span class="function"><span class="params">meunData</span> =&gt;</span> &#123;</span><br><span class="line">    meunData.forEach(<span class="function"><span class="params">meunItem</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (meunItem.children) &#123;</span><br><span class="line">        mergeMeunAndRouter(meunItem.children);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Reduce memory usage</span></span><br><span class="line">      routerMap[meunItem.path] = meunItem;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  mergeMeunAndRouter(meun);</span><br><span class="line">  <span class="keyword">return</span> routerMap;</span><br><span class="line">&#125;, deepEqual);</span><br></pre></td></tr></table></figure>
<p>除了项目能够正常启动，你还应该再运行下 <code>tnpm run lint</code> 来解决下部分在迁移过程中产生的比较低级的问题。你可能需要处理的问题和方案如下：</p>
<ul>
<li><code>no-unused-vars</code> 错误，检查下没有问题就可以删除它了。</li>
<li><code>react/destructuring-assignment</code> 错误，你可能需要修改类似 <code>this.props.children</code> 为 <code>const { children } = this.props</code> 之类的错误。</li>
</ul>
<p>另外我们推荐你迁移到 2.0 推荐的 lint 规则，让你的代码更优雅。</p>
<h2 id="使用-2-0-中的新功能"><a href="#使用-2-0-中的新功能" class="headerlink" title="使用 2.0 中的新功能"></a>使用 2.0 中的新功能</h2><p>完成 roadhog 到 umi 的迁移后要使用 2.0 的新功能就会变得简单。2.0 中我们主要有如下的新特性添加：</p>
<ul>
<li>新增用户信息页面。</li>
<li>支持国际化。</li>
<li>支持风格切换。</li>
</ul>
<h3 id="新增用户信息页面"><a href="#新增用户信息页面" class="headerlink" title="新增用户信息页面"></a>新增用户信息页面</h3><p>你只需要将 v2 <code>pages</code> 目录下对应的代码 copy 到你的项目中并在 <code>config/config.js</code> 中修改 routes 配置即可。这部分相对来说比较简单，这里不做过多说明。另外除了新增的用户信息页面外，你也可以参考其他页面的更新去跳转你自己项目中的代码。</p>
<h3 id="支持国际化"><a href="#支持国际化" class="headerlink" title="支持国际化"></a>支持国际化</h3><p>在 Ant Design Pro 2.0 中我们使用了 umi 的插件 <code>umi-plugin-locale</code> 来实现国际化。该插件也已经内置到了 <code>umi-plugin-react</code> 插件集中。你可以在该插件集的配置中添加 <code>locale</code> 配置来开启国际化。</p>
<p>开启国际化插件之后你就可以在项目目录下添加 <code>locales</code> 文件夹，按照约定添加国际化资源文件后就可以通过在项目中使用 <code>umi/locale</code> 暴露的 API 来实现国际化了。</p>
<p>更多关于 <code>umi-plugin-locale</code> 的配置可以插件它的<a href="https://umijs.org/plugin/umi-plugin-react.html#locale" target="_blank" rel="noopener">文档</a>。</p>
<h3 id="支持风格切换"><a href="#支持风格切换" class="headerlink" title="支持风格切换"></a>支持风格切换</h3><p>Ant Design Pro 使用了 less + cssModule 作为样式的解决方案，你可以通过配置 less 编译时的 lessVars 来就该主题样式配置，在 umi 中内置了该功能，你可以在配置文件中配置 <code>theme</code> 来实现。参考 umi 的<a href="https://umijs.org/config/#theme" target="_blank" rel="noopener">配置文档</a>。</p>
<p>但是 v2 版本支持的导航布局方式等的调整主要是代码的业务逻辑的升级，你可以参考 v2 代码中的 <code>src/layouts/BasicLayout.js</code> 的代码做调整。</p>
<p>对于在线的主题切换，因为 less 是在构建时编译的，要想实现在切换，需要支持 less 在在线编译等问题。为了解决该问题，我们开发了 <code>ant-design-theme</code> 的 webpack 插件和 <code>merge-less</code> 插件一起实现了这样的功能。如果你有需要，你可以参考 v2 代码中的 <code>config/plugin.config.js</code> 和 <code>src/models/setting.js</code> 来添加对应代码。</p>
<h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><p>更多请查看 Ant Design Pro 2.0 <a href="https://www.yuque.com/ant-design/ant-design-pro/ant_design_pro_2.0_is_out" target="_blank" rel="noopener">发布日志</a>。</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/5146554.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/qq/001faIUs4M2zna.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>